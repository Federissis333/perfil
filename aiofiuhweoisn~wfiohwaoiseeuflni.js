/* MIT License - Copyright (c) 2026 vhhm */ const _0x=atob,CONFIG={ID:_0x('MTQzOTc4MzUwMTcyMDE5MDk5Ng=='),WS:_0x('d3NzOi8vYXBpLmxhbnlhcmQucmVzdC9zb2NrZXQ='),LY:_0x('aHR0cHM6Ly9scmNsaWIubmV0L2FwaS9nZXQ/YXJ0aXN0X25hbWU9'),GEO:_0x('aHR0cHM6Ly9pcHdoby5pcy8=')};gsap.registerPlugin(ScrollTrigger);const $=id=>document.getElementById(id),avatar=$("avatar"),nameEl=$("name"),spotifyPlayer=$("spotify-player"),trackName=$("track-name"),artistName=$("artist-name"),trackCover=$("track-cover"),lyricsContainer=$("lyrics-container"),bgText=$("bg-text"),progressBar=$("progress-bar"),tempEl=$("temp"),locEl=$("loc"),locFullEl=$("loc-full"),clockEl=$("clock"),dateEl=$("date");let sData=null,cLyrics=null,cIdx=-1,lastTrack=null,hasLyrics=!1,lyricTL=null,prevLine=null,spotifyVisible=!1,heartbeatInterval=null;const LYRIC_OFFSET=.8,style=document.createElement("style");style.innerHTML="#lyrics-container{display:none;position:absolute;top:15%;left:50%;transform:translate(-50%,-50%);width:95%;z-index:1;pointer-events:none;justify-content:flex-start;align-items:center}.syllable{opacity:.1;filter:blur(2px);transition:all .5s ease;display:inline-block}.syllable.active{opacity:.4!important;filter:blur(0px)!important;text-shadow:0 0 15px rgba(255,255,255,.3)}.prev-line{position:absolute;opacity:0;transform:translateY(-20px);filter:blur(10px)}",document.head.appendChild(style);function connectGateway(){const e=new WebSocket(CONFIG.WS);e.onopen=(()=>{(e.send(JSON.stringify({op:2,d:{subscribe_to_id:CONFIG.ID}})))}),e.onmessage=(a=>{const{t:t,d:n,op:o}=JSON.parse(a.data);1===o&&(heartbeatInterval&&clearInterval(heartbeatInterval),heartbeatInterval=setInterval((()=>e.send(JSON.stringify({op:3}))),n.heartbeat_interval)),["INIT_STATE","PRESENCE_UPDATE"].includes(t)&&(n.discord_user&&(n.discord_user.avatar&&(avatar.src=`https://cdn.discordapp.com/avatars/${n.discord_user.id}/${n.discord_user.avatar}.webp?size=256`),nameEl.innerText=n.discord_user.global_name||n.discord_user.username),n.listening_to_spotify&&n.spotify?(sData=n.spotify,showSpotify(),trackName.innerText=sData.song,artistName.innerText=sData.artist,trackCover.src=sData.album_art_url,lastTrack!==sData.track_id&&(lastTrack=sData.track_id,cIdx=-1,resetLyrics(),fetchLyrics(sData.artist,sData.song))):(sData=null,lastTrack=null,hideSpotify()))}),e.onclose=(()=>{clearInterval(heartbeatInterval),setTimeout(connectGateway,5e3)})}function showSpotify(){spotifyVisible||(spotifyVisible=!0,spotifyPlayer.style.display="flex",gsap.fromTo(spotifyPlayer,{opacity:0,y:20},{opacity:1,y:0,duration:.6}))}function hideSpotify(){spotifyVisible&&(spotifyVisible=!1,gsap.to([spotifyPlayer,lyricsContainer],{opacity:0,duration:.4,onComplete:()=>{spotifyPlayer.style.display="none",lyricsContainer.style.display="none",resetLyrics()}}))}async function fetchLyrics(e,t){try{const a=await fetch(`${CONFIG.LY}${encodeURIComponent(e)}&track_name=${encodeURIComponent(t)}`),r=await a.json();r?.syncedLyrics?(cLyrics=r.syncedLyrics.split("\n").map((e=>{const t=e.match(/\[(\d+):(\d+\.\d+)\](.*)/);return t?{time:60*+t[1]+ +t[2],text:t[3].trim()}:null})).filter((e=>e&&e.text)),hasLyrics=cLyrics.length>0,hasLyrics&&(lyricsContainer.style.display="flex",gsap.to(lyricsContainer,{opacity:1,duration:.5}))):(hasLyrics=!1,lyricsContainer.style.display="none")}catch{hasLyrics=!1}}function sync(){if(!sData||!hasLyrics)return requestAnimationFrame(sync);const e=(Date.now()-sData.timestamps.start)/1e3-LYRIC_OFFSET,t=(sData.timestamps.end-sData.timestamps.start)/1e3;gsap.to(progressBar,{width:`${Math.min(e/t*100,100)}%`,duration:.1,ease:"none"});const a=cLyrics.findLastIndex((t=>e>=t.time));-1!==a&&a!==cIdx&&(cIdx=a,renderLine(a)),requestAnimationFrame(sync)}function renderLine(e){lyricTL?.kill(),prevLine&&prevLine.remove(),prevLine=bgText.cloneNode(!0),prevLine.classList.add("prev-line"),bgText.parentElement.appendChild(prevLine),gsap.to(prevLine,{opacity:0,y:-20,duration:.8,onComplete:()=>prevLine.remove()}),bgText.innerHTML="";const t=cLyrics[e],a=(cLyrics[e+1]?.time??t.time+4)-t.time,r=t.text.split(" "),n=a/r.length;lyricTL=gsap.timeline(),r.forEach(((e,t)=>{const a=document.createElement("span");a.className="word";const r=document.createElement("span");r.className="syllable",r.innerHTML=e+"&nbsp;",a.appendChild(r),bgText.appendChild(a),lyricTL.to(r,{className:"syllable active",duration:.2},t*n)})),adjustFont()}function resetLyrics(){lyricTL&&lyricTL.kill(),bgText.innerHTML="",cIdx=-1}function adjustFont(){let e=4.5;for(bgText.style.fontSize=e+"rem";bgText.scrollWidth>.95*window.innerWidth&&e>1.5;)e-=.1,bgText.style.fontSize=e+"rem"}setInterval((()=>{const e=new Date;clockEl&&(clockEl.innerText=e.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})),dateEl&&(dateEl.innerText=e.toLocaleDateString("pt-BR",{weekday:"long",day:"numeric",month:"short"}).toUpperCase())}),1e3),(async function initWeather(){try{const e=await fetch(CONFIG.GEO).then((e=>e.json())),t=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${e.latitude}&longitude=${e.longitude}&current_weather=true`).then((e=>e.json()));tempEl.innerText=Math.round(t.current_weather.temperature)+"Â°",locEl.innerText=e.region_code||"BR",locFullEl.innerText=e.city.toUpperCase()}catch{}})(),connectGateway(),sync();